{$FRONTEND_DOMAIN}, {$FRONTEND_WWW_DOMAIN} {
  encode zstd gzip

  # Optional: provide an email for ACME/Let's Encrypt notices
  # acme_ca https://acme-v02.api.letsencrypt.org/directory
  # email you@example.com

  # Serve collected static files directly from the shared volume
  handle_path /static/* {
    root * /srv/staticfiles
    file_server
  }

  # Proxy API/Admin/other dynamic requests to Django (Gunicorn) container
  @api path /api* /admin/* /media*
  reverse_proxy @api backend:8000

  # Everything else: serve the built frontend (Nginx) container
  reverse_proxy frontend:80

  # Basic hardening
  header {
    # CORS/frames/etc. adjust as needed
    Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "SAMEORIGIN"
    Referrer-Policy "no-referrer-when-downgrade"
  }
}
